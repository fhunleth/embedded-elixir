

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>The Road to Windows - </title>

  <meta name="description" content="Most Elixir developers prefer Mac or Linux, but Windows is historically the
platform of choice for embedded development.  Therefore as Nerves continues to
grow, a Windows solution is needed.
There are 2 fundamental approaches to Nerves-on-Windows:

Pretend it&rsquo;s Unix
Run it as a Windows app

Unfortunately, there is no &ldquo;silver bullet&rdquo;&ndash;each approach has its trade-offs.">
  <meta name="author" content="Curated by Frank Hunleth"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Embedded Elixir",
    
    "url": "https:\/\/embedded-elixir.com\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/embedded-elixir.com\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/embedded-elixir.com\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/embedded-elixir.com\/post\/2018-01-08-windows-support\/",
          "name": "The road to windows"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Michael Schmidt"
  },
  "headline": "The Road to Windows",
  "description" : "Most Elixir developers prefer Mac or Linux, but Windows is historically the platform of choice for embedded development. Therefore as Nerves continues to grow, a Windows solution is needed.\nThere are 2 fundamental approaches to Nerves-on-Windows:\nPretend it\u0026rsquo;s Unix Run it as a Windows app Unfortunately, there is no \u0026ldquo;silver bullet\u0026rdquo;\u0026ndash;each approach has its trade-offs.\n",
  "inLanguage" : "en",
  "wordCount":  1479 ,
  "datePublished" : "2018-01-08T00:00:00\u002b00:00",
  "dateModified" : "2018-01-08T00:00:00\u002b00:00",
  "image" : "https:\/\/embedded-elixir.com\/images\/logo.png",
  "keywords" : [ "nerves, windows" ],
  "mainEntityOfPage" : "https:\/\/embedded-elixir.com\/post\/2018-01-08-windows-support\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/embedded-elixir.com\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/embedded-elixir.com\/images\/logo.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="The Road to Windows" />
<meta property="og:description" content="Most Elixir developers prefer Mac or Linux, but Windows is historically the
platform of choice for embedded development.  Therefore as Nerves continues to
grow, a Windows solution is needed.
There are 2 fundamental approaches to Nerves-on-Windows:

Pretend it&rsquo;s Unix
Run it as a Windows app

Unfortunately, there is no &ldquo;silver bullet&rdquo;&ndash;each approach has its trade-offs.">
<meta property="og:image" content="https://embedded-elixir.com/images/logo.png" />
<meta property="og:url" content="https://embedded-elixir.com/post/2018-01-08-windows-support/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Embedded Elixir" />

  <meta name="twitter:title" content="The Road to Windows" />
  <meta name="twitter:description" content="Most Elixir developers prefer Mac or Linux, but Windows is historically the
platform of choice for embedded development.  Therefore as Nerves continues to
grow, a Windows solution is needed.
There are â€¦">
  <meta name="twitter:image" content="https://embedded-elixir.com/images/logo.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://embedded-elixir.com/images/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.155.3">
  <link rel="alternate" href="https://embedded-elixir.com/index.xml" type="application/rss+xml" title="Embedded Elixir"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/brands.css" integrity="sha384-+eXGm6TmVoCZR1gX03US+L++L2mJIfOvp2X0+luTuEktXaF5F+e3zn0sO0HBvOyT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/fontawesome.css" integrity="sha384-B5nyPZa7e84uCJEYHtevCdVYtQosWsbDSRtq3cy/jeSVtQW05GL8CKXO7waXsjPK" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/regular.css" integrity="sha384-V71z/A/p/DGaZAryHhiSXRQj8HdQmK2nBgL2bX23MGD+h6ZKpyxOO76f5eSXmIaj" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/solid.css" integrity="sha384-1IIShlrK5iYgvS7OAgIH3prz4RAFP7hHZ2MaLIb9l3+trFwwnw/NdCWcUHlymZDU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/svg.css" integrity="sha384-iBa7uugTOHXqQ2ngvDYJyKrPPQbd9n2P3EQe+o/0+HZe5TNvV+LO5X0lLLUrXLHP" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/svg-with-js.css" integrity="sha384-STWnS5AGz6M2YxsnGAd536EqcE2y+ktGovMMuhtXLsCBtl7lujeQj2eN4eDxa57x" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/v4-font-face.css" integrity="sha384-fH83IkgQi7kturzlxpXfNdsR8aUOcqj5HUORRVnSvJgObZkIw6aqKAaQx20IWyB/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/v4-shims.css" integrity="sha384-cCODJHSivNBsaHei/8LC0HUD58kToSbDU+xT7Rs51BO1v/IvgT/uM0W6xMoUqKfn" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v7.0.1/css/v5-font-face.css" integrity="sha384-atSdF89mIn15dv+o2LKkDM6mCh3hwh6A7mwZ6F2it/kenqZbMu+QW/ye1OG4XSWV" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://embedded-elixir.com/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://embedded-elixir.com/css/syntax.css" /><link rel="stylesheet" href="https://embedded-elixir.com/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://embedded-elixir.com/">Embedded Elixir</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Newsletter" href="https://nerves-project.org/newsletter">Newsletter</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Embedded Elixir" href="https://embedded-elixir.com/">
            <img class="avatar-img" src="https://embedded-elixir.com/images/logo.png" alt="Embedded Elixir" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>The Road to Windows</h1>
              
              
              
              
                <span class="post-meta">
  
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on January 8, 2018
  
  
  
  
    
      
        &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Michael Schmidt
      
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Most Elixir developers prefer Mac or Linux, but Windows is historically the
platform of choice for embedded development.  Therefore as Nerves continues to
grow, a Windows solution is needed.</p>
<p>There are 2 fundamental approaches to Nerves-on-Windows:</p>
<ol>
<li>Pretend it&rsquo;s Unix</li>
<li>Run it as a Windows app</li>
</ol>
<p>Unfortunately, there is no &ldquo;silver bullet&rdquo;&ndash;each approach has its trade-offs.</p>
<h2 id="pretend-its-unix">Pretend it&rsquo;s Unix</h2>
<p>There are several ways to make Windows pretend its Unix:</p>
<ol>
<li>Cygwin</li>
<li>Mingw</li>
<li>Linux VM
<ol>
<li>WSL</li>
<li>Docker</li>
<li>Virtualized (Virtual Box / VMWare)</li>
</ol>
</li>
</ol>
<p>At present, there really aren&rsquo;t any solutions that leverage Cygwin or Mingw.
Virtualized solutions tend to act like Native Linux, so we will focus on WSL and
Docker.</p>
<h3 id="wsl">WSL</h3>
<p>Mac users have long enjoyed a robust Unix environment.  With Windows 10,
Microsoft has finally decided to follow suite with is Windows for Linux
Subsystem.  Unfortunately there are several distinct versions of Windows 10,
each with their distinct version of Ubuntu.</p>
<ol>
<li>Original Release - No WSL</li>
<li>Anniversary Update - WSL is in its infancy @ Ubuntu 14.04.  Cannot run Erlang
and thus Elixir</li>
<li>Creators Update - WSL updated to Ubuntu 16.04.  First Version that runs
Elixir</li>
<li>Fall Creators Update - Additional features that don&rsquo;t impact Elixir/Nerves</li>
</ol>
<p>Updating Windows between these releases is problematic (at best), but if your
machine can run Creators Update (or later), Nerves becomes a 1st class citizen.</p>
<ul>
<li>The Good
<ul>
<li>Nerves can run all steps except <code>firmware.burn</code> the same as Mac and Linux</li>
</ul>
</li>
<li>The Bad
<ul>
<li>No access to SD Cards from WSL</li>
<li>Choice of git directory has consequences
<ul>
<li>/mnt/c/* - Permission issues will abound</li>
<li>~/* - Can&rsquo;t access files via Windows Editors</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="docker">Docker</h3>
<p>Docker on Windows comes in 2 distinct flavors:</p>
<ol>
<li>Docker Toolbox - Uses VirtualBox to create a Linux VM.  Supports Windows 7+</li>
<li>Docker for Windows - Uses Hyper-V to create a Linux VM.  Windows Anniversary</li>
</ol>
<p>Update+ (Note that Original Release is officially supported, severe issues are
common.  You Have Been Warned)</p>
<ul>
<li>The Good
<ul>
<li>Same as WSL</li>
<li>Can use &ldquo;volumes&rdquo; which are Linux Native FS.  This preserves file case and
permissions.</li>
<li>Expose volumes via Samba for Windows Editors</li>
</ul>
</li>
<li>The Bad
<ul>
<li>No access to SD Cards (same as WSL)</li>
<li>Docker Toolbox has same issues as WSL ~/* files</li>
<li>Docker for Windows has same issues as /mnt/c/* for non-volumes</li>
<li>Git over Samba has issues tracking execute permissions</li>
</ul>
</li>
</ul>
<h2 id="run-as-windows">Run as Windows</h2>
<p>The second major approach is to run Nerves &ldquo;natively&rdquo; on Windows the same way
its run on Mac.  Since Windows is not a Unix OS, there are some extra catches.</p>
<ol>
<li>Paths: The modules which setup the cross-compiler have to be modified to
support Windows-style paths</li>
<li>Symbolic links: Windows has progressively adds symbolic links over the last
several versions, but they still operate differently than their Unix
counter-parts.  The major sticking point is that Windows does not allow the
creation of symbolic links to a location that does not exist.  This causes
huge issues when trying to unpack a nerves_system archive, as the symbolic
links may occur before the files that they reference</li>
<li>File Case Sensitivity: The Linux kernel has files that differs only in case.
This makes it hard to even unpack on a Windows file system</li>
<li>Ecosystem: Many dependencies (accidentally??) require a unix environment to
compile</li>
</ol>
<h1 id="installation">Installation</h1>
<h2 id="wsl-1">WSL</h2>
<p>If you are running Windows 10 Creator&rsquo;s Update, then the choice is easy:  use
WSL. Tim Mecklem has a great <a href="https://www.youtube.com/watch?v=rzV0qfhzzqc">video
here</a>.</p>
<p>Note:  To avoid pain, always run &ldquo;git&rdquo; from WSL.</p>
<h2 id="docker-1">Docker</h2>
<p>For previous version of Windows, Docker Toolbox works fairly well, and gives an
environment close to WSL.  The CROPS project has step-by-step
<a href="https://github.com/crops/docker-win-mac-docs/wiki/Windows-Instructions-%28Docker-Toolbox%29">instructions here</a>.</p>
<p>The above link will get you going with a &ldquo;Base&rdquo; Ubuntu 16 image.  We still need
to create a dockerfile that has Elixir + Nerves dependencies.</p>
<p>First we will need to create a file named &ldquo;Dockerfile&rdquo; with the following contents:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="line"><span class="cl"><span class="k">FROM</span><span class="w"> </span><span class="s">crops/poky</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/tmp</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">USER</span><span class="w"> </span><span class="s">root</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    apt-get install -y squashfs-tools docbook-xsl inotify-tools vim emacs npm nodejs nodejs-legacy software-properties-common python-software-properties <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    add-apt-repository ppa:git-core/ppa <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    apt-get update <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    apt-get install -y git <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">RUN</span> wget https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    dpkg -i erlang-solutions_1.0_all.deb <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    rm erlang-solutions_1.0_all.deb<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="c"># Everything below will likely need to be updated periodically.</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">RUN</span> npm install -g n <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    n lts <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    apt-get remove -y nodejs nodejs-legacy<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">RUN</span> wget https://github.com/fhunleth/fwup/releases/download/v0.19.0/fwup_0.19.0_amd64.deb <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    dpkg -i fwup_0.19.0_amd64.deb <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    rm fwup_0.19.0_amd64.deb<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    apt-get install -y esl-erlang<span class="o">=</span>1:20.2.2 <span class="nv">elixir</span><span class="o">=</span>1.5.2-1 <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="k">RUN</span> <span class="nv">HOME</span><span class="o">=</span>/etc/skel mix local.hex --force <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">HOME</span><span class="o">=</span>/etc/skel mix local.rebar --force <span class="o">&amp;&amp;</span><span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">HOME</span><span class="o">=</span>/etc/skel mix archive.install https://github.com/nerves-project/archives/raw/main/nerves_bootstrap.ez --force<span class="err">
</span></span></span></code></pre></div><p>The build process creates no artifacts in the local directory, so the file can
be put anywhere</p>
<p>Once you have your Dockerfile, use it to create a image named
<code>nerves_developer</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker build nerves_developer .
</span></span></code></pre></div><p>Also create a volume to persist your home directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker volume create myhome
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This will copy ssh keys into the new home directory</span>
</span></span><span class="line"><span class="cl">docker create -v  myhome:/home/pokyuser --name busybox_container busybox
</span></span><span class="line"><span class="cl"><span class="c1"># Note there is a bug where docker cp can&#39;t use full paths that map back to /c/*, so workaround with pushd</span>
</span></span><span class="line"><span class="cl"><span class="nb">pushd</span> <span class="nv">$HOME</span>
</span></span><span class="line"><span class="cl">docker cp .ssh  busybox_container:/home/pokyuser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Copying .gitconfig&#34;</span>
</span></span><span class="line"><span class="cl">docker cp .gitconfig busybox_container:/home/pokyuser
</span></span><span class="line"><span class="cl"><span class="nb">popd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Copying .bashrc&#34;</span>
</span></span><span class="line"><span class="cl">docker cp .bashrc busybox_container:/home/pokyuser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker run -it --rm -v myhome:/home/pokyuser busybox chown -R 1000:1000 /home/pokyuser
</span></span><span class="line"><span class="cl">docker run -it --rm -v myhome:/home/pokyuser busybox chmod -R <span class="m">700</span> /home/pokyuser/.ssh
</span></span><span class="line"><span class="cl">docker rm busybox_container
</span></span></code></pre></div><p>Finally run the container from your <code>nerves_developer</code> image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run --rm -it --hostname docker -p 4000:4000 -p 9100-9109:9100-9109 -v myhome:/home/pokyuser -v myvolume:/workdir nerves_developer --workdir<span class="o">=</span>/workdir
</span></span></code></pre></div><p>Docker commands are very verbose.  Here is a quick breakdown:</p>
<ul>
<li>&ldquo;run&rdquo; a new container interactively (-it) from <code>nerves_developer</code> image and delete it (&ndash;rm) when done</li>
<li>Set the host name of the container to &ldquo;docker&rdquo; (&ndash;hostname docker).  This comes into play when doing distributed Erlang stuff</li>
<li>Expose the ports (-p) 4000, 9100-9109.  4000 is the default for Phoenix, and 910x is for Distributed Erlang</li>
<li>Mount volumes (-v).  Docker containers do not save state, so to make directories permanent we have to mount them as a &ldquo;volume&rdquo;.</li>
<li>The CROPS scripts expect a workdir to be specifed.  We use their convention and chose /workdir</li>
</ul>
<p>Finally, to access files from Windows programs, mount /workdir as a network drive</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl">net use a: \\192.168.99.100\workdir
</span></span></code></pre></div><h3 id="docker---advanced">Docker - Advanced</h3>
<p>The above setup will create a new temporary container each time the command is
run, and cleanup after it exits.  What if you want a single container with
multiple shells attached?  This is easily done.  :</p>
<p>Instead of the &ldquo;run&rdquo; command, we first need to &ldquo;create&rdquo; a new container
<code>nerves_dev</code> from your <code>nerves_developer</code> image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker create -t --user usersetup -v myvolume:/workdir --name nerves_dev --hostname docker -v myhome:/home/pokyuser -p 4000:4000 -p 9100-9109:9100-9109 nerves_developer --workdir<span class="o">=</span>/workdir
</span></span></code></pre></div><p>You should recognized most of the options from before.  The only new one is
&ldquo;&ndash;user&rdquo;, which lets us specify the user to run the container as.  The
<code>usersetup</code> user is part of the CROPS ecosystem.</p>
<p>Finally, attach a new shell to the container.  You can attach as many shells
desired, and they will all share the same container</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it -u pokyuser nerves_dev poky-launch.sh /workdir bash -l
</span></span></code></pre></div><h2 id="docker---transparent-proxy">Docker - Transparent Proxy</h2>
<p>Docker&rsquo;s main advantage over WSL is its support for creating a &ldquo;Transparent&rdquo;
proxy. This is needed in many corporate environments where firewalls interfere
with the SSL Certificate checks that are done by mix, npm and other package
managers. See <a href="https://github.com/crops/chameleonsocks">github/chameleonsocks</a>
if this pertains to you.</p>
<h2 id="burning-sd-cards-and-guis">Burning SD Cards and GUIs</h2>
<p>Neither WSL or Docker allow GUIs or direct burning of SD Cards.  Thus we will
need to install the native windows tools for this. The easiest way is to install
<a href="https://chocolatey.org/">Chocolately</a></p>
<p>Next install fwup and elixir packages:</p>
<ul>
<li><code>fwup</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl">choco install fwup
</span></span></code></pre></div></li>
<li><code>elixir</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl">choco install elixir
</span></span></code></pre></div></li>
</ul>
<h3 id="sd-card">SD Card</h3>
<p>To burn an SD Card, you must run &ldquo;fwup&rdquo; from a Windows Command Prompt with
Administrator priviledges.</p>
<ul>
<li>Launch a new Command Prompt as Administrator</li>
<li>(Docker Only) The Administrator does not have access to mapped drives of the
normal user, so you must re-mount the Samba share:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl">net use a: \\192.168.99.100\workdir
</span></span></code></pre></div></li>
<li>(WSL Only) Copy the .fw file to your Windows Desktop</li>
<li>Finally, run <code>fwup</code> to burn the SD Card.
Docker:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl">a<span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="k">cd</span> <span class="p">&lt;</span>path to nerves project&gt;
</span></span><span class="line"><span class="cl">fwup -a -i _build\<span class="p">&lt;</span>target<span class="p">&gt;</span>\dev\nerves\images\myfirmware.fw -t complete
</span></span></code></pre></div>WSL:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl"><span class="k">cd</span> Desktop
</span></span><span class="line"><span class="cl">fwup -a -i myfirmware.fw -t complete
</span></span></code></pre></div></li>
</ul>
<h2 id="erlang-guis">Erlang GUIs</h2>
<p>Erlang ships with a variety of GUI applications to help with debugging.  The
most useful of these is Observer</p>
<p>Launching this on Windows is 2 step process</p>
<ul>
<li>
<p>Launch your app with distribution enabled:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">iex --sname my_app --cookie cookie --erl <span class="s2">&#34;-kernel inet_dist_listen_min 9100 inet_dist_listen_max 9109&#34;</span> -S mix
</span></span></code></pre></div></li>
<li>
<p>Create a new file named <code>inetrc</code> to let erlang find our docker app</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-erlang" data-lang="erlang"><span class="line"><span class="cl"><span class="p">{</span><span class="n">host</span><span class="p">,{</span><span class="mi">192</span><span class="p">,</span><span class="mi">168</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">100</span><span class="p">},</span> <span class="p">[</span><span class="s">&#34;docker&#34;</span><span class="p">]}.</span>
</span></span></code></pre></div></li>
<li>
<p>From Windows, Launch Observer</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nv">ERL_INETRC</span><span class="o">=</span>inetrc iex --sname observer --cookie cookie -e <span class="s2">&#34;:observer.start()&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Finally attach to the remote node</p>
<ul>
<li>select Nodes-&gt;Connect Nodes&quot;</li>
<li>type &lsquo;my_app@docker&rsquo;</li>
</ul>
</li>
</ul>
<p>Note even though we have named the node &ldquo;docker&rdquo;, the above procedure should
work for WSL as well.</p>
<h2 id="conclusion">Conclusion</h2>
<p>WSL is a great way to get Nerves running on Windows.  For older versions of
Windows, or Windows in a corporate network, Docker can provide a similar
experience</p>

        
          <div class="blog-tags">
            
              
              <a href="https://embedded-elixir.com/tags/nerves/">nerves</a>&nbsp;
            
              
              <a href="https://embedded-elixir.com/tags/windows/">windows</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://embedded-elixir.com/post/2018-01-02-nerves-update/" data-toggle="tooltip" data-placement="top" title="January 2018 Nerves Update">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://embedded-elixir.com/post/2018-01-08-firmware-revert/" data-toggle="tooltip" data-placement="top" title="Reverting firmware updates">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
      
      
      
      
          
          <div class="disqus-comments">
            
  
    <div class="comments">
      <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "embedded-elixir" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  


          </div>
          
        
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="https://github.com/fhunleth" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://bsky.app/profile/fhunleth.bsky.social" title="Bluesky">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-bluesky fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Curated by Frank Hunleth
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2023
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://embedded-elixir.com/">Embedded Elixir</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.155.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://embedded-elixir.com/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://embedded-elixir.com/js/load-photoswipe.js"></script>










    
  </body>
</html>

